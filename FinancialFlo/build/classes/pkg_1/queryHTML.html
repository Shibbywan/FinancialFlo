<!DOCTYPE html>
<form id="finance">
<p><label for="query">Enter Company:</label>
<input id="query" type="text"/></p>
<p><input type="submit" value="Make Query"/></p>
</form>
<div id="results"></div>

<script>
/*
  This example shows how to use YQL to 
  make queries to the GEO Web service.
  The call to the YQL Web service uses 
  2-legged OAuth and is made with OpenSocial 
  functions.
*/ 
function makeQuery(e){
  e.preventDefault(); // do not send off form 
  var container = document.getElementById('results');
  var company = document.getElementById('query').value || 'KMB';
  var content = '';

  var BASE_URI = 'http://query.yahooapis.com/v1/yql';

  // function calling the opensocial makerequest method
  function runQuery(query, handler) {
    gadgets.io.makeRequest(BASE_URI, handler, {
        METHOD: 'POST',
        POST_DATA: toQueryString({q: query, format: 'json'}),
        CONTENT_TYPE: 'JSON',
        AUTHORIZATION: 'OAuth'
    });
  };
  
  // Tool function to create a request string
  function toQueryString(obj) {
    var parts = [];
    for(var each in obj) if (obj.hasOwnProperty(each)) {
      parts.push(encodeURIComponent(each) + '=' +
                 encodeURIComponent(obj[each]));
    }
    return parts.join('&');
  };
  
  // Run YQL query to Finance API and extract data from response  
  runQuery('SELECT * FROM yahoo.finance.balancesheet WHERE symbol=' + company + '"',
    function(rsp) {
      if(rsp.data){
        var company = rsp.data.query.results.balancesheet;
        if(company[0]){
          company = company[0];
        }
        var name      = company.symbol || 'Unknown';
        var timeframe   = company.timeframe || 'Unknown';
        var period = company.statement.period || 'Unknown';
        var cashAndCashE = company.statement.CashAndCashEquivalents || 'Unknown';
        var shortTermInvestments = company.statement.ShortTermInvestments || 'Unknown';

 
        content = '<ul><li><strong>Company Name: </strong>' + name + '</li>' +
        '<li><strong>Timeframe: </strong>' + timeframe + '</li>'+ '<li><strong>Period: ' + period +
        '</li>' + '<li><strong>Cash and Cash Equalivalents: ' + cashAndCashE + '</li>' + '<li><strong>Short Term Invesments: ' +
        shortTermInvestments + '<li>';
        container.innerHTML = content;
      }
      else {
        container.innerHTML = gadgets.json.stringify(rsp);
      }
  });
}
// Create an event handler for submitting the form
var form = document.getElementById('geosearch');
form.addEventListener('submit',makeQuery,false);
</script>